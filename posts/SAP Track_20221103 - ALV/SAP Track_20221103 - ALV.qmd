---
title: "Co-op SAP Track 20221103 - ALV"
author: "Siyun Min"
date: "2022-11-03"
categories: [SSU, SAP]
---
# 20221103 - ALV

CHAR 72의 문제가 있음

[째니의 테이블 : 네이버 블로그](https://blog.naver.com/jenny_table/222116898031)

# ALV function

# ALV 레이아웃

IS_LAYOUT parameter를 이용하여 ALV 화면 속성 정의

즉, ALV 리스트의 속성을 정의할 때 사용

레이아웃은 LVC_S_LAYO 타입의 구조체

- ex) 줄무늬 패턴으로 조회, 합계 금액 display…

cf. 필드 카탈로그에는 스크린(화면)에 조회되는 구조를 정의한다면, (데이터 구조, 기술속성, 내역) ALV 레이아웃은 레이아웃 틀을 결정

1. DATA 선언

```abap
DATA: GS_LAYOUT TYPE SLIS_LAYOUT_ALV
```

![Untitled](./Untitled.png)

1. 레이아웃 변수의 속성을 설정

![Untitled](./Untitled%201.png)

![Untitled](./Untitled%202.png)

![Untitled](./Untitled%203.png)

![Untitled](./Untitled%204.png)

![Untitled](./Untitled%205.png)

합계(DO_SUM)만 됨

1. ALV 함수 호출 시 parameter IS_LAYOUT 추가

```abap
CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
	EXPORTING
		IS_LAYOUT = GS_LAYOUT
```

![Untitled](./Untitled%206.png)

```abap
TYPE-POOLS: SLIS, ICON.

DATA GT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV.
DATA GS_FIELDCAT TYPE SLIS_FIELDCAT_ALV.
DATA GS_LAYOUT TYPE SLIS_LAYOUT_ALV.

DATA: BEGIN OF GS_SFLIGHT,
  COLOR TYPE C LENGTH 4,
  LIGHT TYPE C,
  CARRID LIKE SFLIGHT-CARRID,
  CONNID LIKE SFLIGHT-CONNID,
  PRICE LIKE SFLIGHT-PRICE,
  FLDATE LIKE SFLIGHT-FLDATE,
  CELLCOLOR TYPE LVC_T_SCOL,
  CELLBUTTON TYPE LVC_T_STYL,
  END OF GS_SFLIGHT.
DATA: GT_SFLIGHT LIKE TABLE OF GS_SFLIGHT.

SELECT * FROM SFLIGHT INTO CORRESPONDING FIELDS OF TABLE GT_SFLIGHT WHERE CARRID = 'AA'.

CLEAR: GT_FIELDCAT, GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 1.
GS_FIELDCAT-FIELDNAME = 'CARRID'.
GS_FIELDCAT-SELTEXT_M = '항공코드'.
GS_FIELDCAT-KEY ='X'.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

CLEAR: GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 2.
GS_FIELDCAT-FIELDNAME = 'CONNID'.
GS_FIELDCAT-SELTEXT_M = '편명'.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

CLEAR: GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 3.
GS_FIELDCAT-FIELDNAME = 'PRICE'.
GS_FIELDCAT-SELTEXT_M = '가격'.
GS_FIELDCAT-CURRENCY = 'KRW'.
GS_FIELDCAT-JUST = 'R'.
GS_FIELDCAT-DO_SUM = 'X'.
GS_FIELDCAT-OUTPUTLEN = 20.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

GS_LAYOUT-NO_COLHEAD = 'X'.
GS_LAYOUT-ZEBRA = 'X'.
GS_LAYOUT-NO_HLINE = 'X'.
GS_LAYOUT-EDIT = 'X'.
GS_LAYOUT-TOTALS_BEFORE_ITEMS = 'X'.

CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
  EXPORTING
    IT_FIELDCAT = GT_FIELDCAT
    IS_LAYOUT = GS_LAYOUT
  TABLES
    T_OUTTAB = GT_SFLIGHT.
```

# ALV SORT 기능

ALV 실행 시 데이터가 정렬이 된 상태로 조회되도록 설정

OSRT는 아래와 같은 타입으로 선언 된 internal table을 선언하고,

```abap
FUNCTION ALV: SLIS_SORTINFO_ALV
CLASS ALV: LVC_T_SORT "구조체를 사용하고 싶으면 LVC_S_SORT
```

이 테이블에 정렬하고자 하는 필드 추가

## IT_SORT 속성

1. SPOS - 정럴 순서를 지정
2. FIELDNAME - 정렬이 필요한 필드명을 지정
3. UP - 오름차순을 정렬하는 설정
4. DOWN - 내림차순을 내리는 설정
5. SUBTOT - 중간합계

![Untitled](./Untitled%207.png)

![Untitled](./Untitled%208.png)

![Untitled](./Untitled%209.png)

```abap
TYPE-POOLS: SLIS, ICON.

DATA GT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV.
DATA GS_FIELDCAT TYPE SLIS_FIELDCAT_ALV.
DATA GS_LAYOUT TYPE SLIS_LAYOUT_ALV.
DATA GT_SORT TYPE SLIS_SORTINFO_ALV OCCURS 0.
DATA GS_SORT TYPE SLIS_SORTINFO_ALV.

DATA: BEGIN OF GS_SFLIGHT,
  COLOR TYPE C LENGTH 4,
  LIGHT TYPE C,
  CARRID LIKE SFLIGHT-CARRID,
  CONNID LIKE SFLIGHT-CONNID,
  PRICE LIKE SFLIGHT-PRICE,
  FLDATE LIKE SFLIGHT-FLDATE,
  CELLCOLOR TYPE LVC_T_SCOL,
  CELLBUTTON TYPE LVC_T_STYL,
  END OF GS_SFLIGHT.
DATA: GT_SFLIGHT LIKE TABLE OF GS_SFLIGHT.

SELECT * FROM SFLIGHT INTO CORRESPONDING FIELDS OF TABLE GT_SFLIGHT.

CLEAR: GT_FIELDCAT, GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 1.
GS_FIELDCAT-FIELDNAME = 'CARRID'.
GS_FIELDCAT-SELTEXT_M = '항공코드'.
GS_FIELDCAT-KEY ='X'.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

CLEAR: GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 2.
GS_FIELDCAT-FIELDNAME = 'CONNID'.
GS_FIELDCAT-SELTEXT_M = '편명'.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

CLEAR: GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 3.
GS_FIELDCAT-FIELDNAME = 'PRICE'.
GS_FIELDCAT-SELTEXT_M = '가격'.
GS_FIELDCAT-CURRENCY = 'KRW'.
GS_FIELDCAT-JUST = 'R'.
GS_FIELDCAT-DO_SUM = 'X'.
GS_FIELDCAT-OUTPUTLEN = 20.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

*GS_LAYOUT-NO_COLHEAD = 'X'.
GS_LAYOUT-ZEBRA = 'X'.
*GS_LAYOUT-NO_HLINE = 'X'.
*GS_LAYOUT-EDIT = 'X'.
GS_LAYOUT-TOTALS_BEFORE_ITEMS = 'X'.

GS_SORT-SPOS = '1'.
GS_SORT-FIELDNAME = 'CARRID'.
GS_SORT-UP = 'X'.
APPEND GS_SORT TO GT_SORT.

CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
  EXPORTING
    IT_FIELDCAT = GT_FIELDCAT
    IS_LAYOUT = GS_LAYOUT
    IT_SORT = GT_SORT
  TABLES
    T_OUTTAB = GT_SFLIGHT.
```

### IT_SORT 속성 - SUBTOTAL

![Untitled](./Untitled%2010.png)

![Untitled](./Untitled%2011.png)

```abap
TYPE-POOLS: SLIS, ICON.

DATA GT_FIELDCAT TYPE SLIS_T_FIELDCAT_ALV.
DATA GS_FIELDCAT TYPE SLIS_FIELDCAT_ALV.
DATA GS_LAYOUT TYPE SLIS_LAYOUT_ALV.
DATA GT_SORT TYPE SLIS_SORTINFO_ALV OCCURS 0.
DATA GS_SORT TYPE SLIS_SORTINFO_ALV.

DATA: BEGIN OF GS_SFLIGHT,
  COLOR TYPE C LENGTH 4,
  LIGHT TYPE C,
  CARRID LIKE SFLIGHT-CARRID,
  CONNID LIKE SFLIGHT-CONNID,
  PRICE LIKE SFLIGHT-PRICE,
  FLDATE LIKE SFLIGHT-FLDATE,
  CELLCOLOR TYPE LVC_T_SCOL,
  CELLBUTTON TYPE LVC_T_STYL,
  END OF GS_SFLIGHT.
DATA: GT_SFLIGHT LIKE TABLE OF GS_SFLIGHT.

SELECT * FROM SFLIGHT INTO CORRESPONDING FIELDS OF TABLE GT_SFLIGHT.

CLEAR: GT_FIELDCAT, GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 1.
GS_FIELDCAT-FIELDNAME = 'CARRID'.
GS_FIELDCAT-SELTEXT_M = '항공코드'.
GS_FIELDCAT-KEY ='X'.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

CLEAR: GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 2.
GS_FIELDCAT-FIELDNAME = 'CONNID'.
GS_FIELDCAT-SELTEXT_M = '편명'.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

CLEAR: GS_FIELDCAT.
GS_FIELDCAT-COL_POS = 3.
GS_FIELDCAT-FIELDNAME = 'PRICE'.
GS_FIELDCAT-SELTEXT_M = '가격'.
GS_FIELDCAT-CURRENCY = 'KRW'.
GS_FIELDCAT-JUST = 'R'.
GS_FIELDCAT-DO_SUM = 'X'.
GS_FIELDCAT-OUTPUTLEN = 20.
APPEND GS_FIELDCAT TO GT_FIELDCAT.

*GS_LAYOUT-NO_COLHEAD = 'X'.
GS_LAYOUT-ZEBRA = 'X'.
*GS_LAYOUT-NO_HLINE = 'X'.
*GS_LAYOUT-EDIT = 'X'.
GS_LAYOUT-TOTALS_BEFORE_ITEMS = 'X'.

GS_SORT-SPOS = '1'.
GS_SORT-FIELDNAME = 'CARRID'.
GS_SORT-UP = 'X'.
GS_SORT-SUBTOT = 'X'.
APPEND GS_SORT TO GT_SORT.

CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
  EXPORTING
    IT_FIELDCAT = GT_FIELDCAT
    IS_LAYOUT = GS_LAYOUT
    IT_SORT = GT_SORT
  TABLES
    T_OUTTAB = GT_SFLIGHT.
```

# Download

[내가 좋아하는것을 예쁘게 찍어 아름답게 남기자 : 네이버 블로그](https://blog.naver.com/aaaa123krkr/220788760310)